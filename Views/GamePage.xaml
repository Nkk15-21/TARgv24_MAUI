<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TARgv24.Views.GamePage"
             Title="Game"
             BackgroundColor="{DynamicResource PageBg}">

    <Grid RowDefinitions="Auto,*,Auto" Padding="16" RowSpacing="12">
        <!-- Info -->
        <VerticalStackLayout Grid.Row="0" Spacing="6">
            <Label Text="{Binding CurrentPlayerText}" FontSize="18"/>
            <Label Text="{Binding MovesText}" />
            <Label Text="{Binding TimerText}" />
        </VerticalStackLayout>

        <!-- Drag source: текущий символ -->
        <Frame Grid.Row="0" HorizontalOptions="End" Padding="6"
           BackgroundColor="{DynamicResource Accent}" CornerRadius="8">
            <Label x:Name="DragSymbol"
             Text="{Binding CurrentSymbol}"
             FontSize="24" FontAttributes="Bold"
             VerticalOptions="Center" HorizontalOptions="Center">
                <Label.GestureRecognizers>
                    <DragGestureRecognizer CanDrag="True" DragStarting="OnDragStarting" />
                </Label.GestureRecognizers>
            </Label>
        </Frame>

        <!-- Board 3x3 -->
        <Grid Grid.Row="1" ColumnDefinitions="*,*,*" RowDefinitions="*,*,*"
      ColumnSpacing="8" RowSpacing="8">

            <Border Style="{StaticResource CellBorderStyle}" Grid.Row="0" Grid.Column="0">
                <Grid>
                    <Label Text="{Binding Cells[0].Symbol}" FontSize="48"
             HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Grid.GestureRecognizers>
                        <DropGestureRecognizer AllowDrop="True"
                               Drop="Cell_Drop" DragOver="Cell_DragOver" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Border>
            <!-- 9 cells -->
            <Frame Style="{StaticResource CellFrameStyle}" Grid.Row="0" Grid.Column="0">
                <Grid>
                    <Label Text="{Binding Cells[0].Symbol}" FontSize="48" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Grid.GestureRecognizers>
                        <DropGestureRecognizer AllowDrop="True" Drop="Cell_Drop" DragOver="Cell_DragOver" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Frame>
            <Frame Style="{StaticResource CellFrameStyle}" Grid.Row="0" Grid.Column="1">
                <Grid>
                    <Label Text="{Binding Cells[1].Symbol}" FontSize="48" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Grid.GestureRecognizers>
                        <DropGestureRecognizer AllowDrop="True" Drop="Cell_Drop" DragOver="Cell_DragOver" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Frame>
            <Frame Style="{StaticResource CellFrameStyle}" Grid.Row="0" Grid.Column="2">
                <Grid>
                    <Label Text="{Binding Cells[2].Symbol}" FontSize="48" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Grid.GestureRecognizers>
                        <DropGestureRecognizer AllowDrop="True" Drop="Cell_Drop" DragOver="Cell_DragOver" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Frame>

            <Frame Style="{StaticResource CellFrameStyle}" Grid.Row="1" Grid.Column="0">
                <Grid>
                    <Label Text="{Binding Cells[3].Symbol}" FontSize="48" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Grid.GestureRecognizers>
                        <DropGestureRecognizer AllowDrop="True" Drop="Cell_Drop" DragOver="Cell_DragOver" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Frame>
            <Frame Style="{StaticResource CellFrameStyle}" Grid.Row="1" Grid.Column="1">
                <Grid>
                    <Label Text="{Binding Cells[4].Symbol}" FontSize="48" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Grid.GestureRecognizers>
                        <DropGestureRecognizer AllowDrop="True" Drop="Cell_Drop" DragOver="Cell_DragOver" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Frame>
            <Frame Style="{StaticResource CellFrameStyle}" Grid.Row="1" Grid.Column="2">
                <Grid>
                    <Label Text="{Binding Cells[5].Symbol}" FontSize="48" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Grid.GestureRecognizers>
                        <DropGestureRecognizer AllowDrop="True" Drop="Cell_Drop" DragOver="Cell_DragOver" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Frame>

            <Frame Style="{StaticResource CellFrameStyle}" Grid.Row="2" Grid.Column="0">
                <Grid>
                    <Label Text="{Binding Cells[6].Symbol}" FontSize="48" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Grid.GestureRecognizers>
                        <DropGestureRecognizer AllowDrop="True" Drop="Cell_Drop" DragOver="Cell_DragOver" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Frame>
            <Frame Style="{StaticResource CellFrameStyle}" Grid.Row="2" Grid.Column="1">
                <Grid>
                    <Label Text="{Binding Cells[7].Symbol}" FontSize="48" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Grid.GestureRecognizers>
                        <DropGestureRecognizer AllowDrop="True" Drop="Cell_Drop" DragOver="Cell_DragOver" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Frame>
            <Frame Style="{StaticResource CellFrameStyle}" Grid.Row="2" Grid.Column="2">
                <Grid>
                    <Label Text="{Binding Cells[8].Symbol}" FontSize="48" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Grid.GestureRecognizers>
                        <DropGestureRecognizer AllowDrop="True" Drop="Cell_Drop" DragOver="Cell_DragOver" />
                    </Grid.GestureRecognizers>
                </Grid>
            </Frame>
        </Grid>

        <!-- Controls -->
        <Grid Grid.Row="2" ColumnDefinitions="*,Auto">
            <Button Text="Restart" Command="{Binding ResetCommand}" />
        </Grid>
    </Grid>
</ContentPage>
